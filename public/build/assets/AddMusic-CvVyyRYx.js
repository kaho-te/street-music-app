import{r,W as M,q as A,j as t,d as z}from"./app-DoXcT2EI.js";import{B as V,T as n,a as b,s as O}from"./mui-file-input.es-GZ59ryEe.js";import{R as W,a as q}from"./RecordRTC-DUbwg6C8.js";import{B as G,R as H,F as R,a as w,d as I,b as K}from"./Stop-DLKxXFWt.js";import"./ButtonBase-BN4DkJN0.js";const P=d=>{const o=new Date,u=o.getFullYear(),m=o.getMonth()+1,l=o.getDate(),j=o.getHours(),g=o.getMinutes(),p=o.getSeconds();return`${u}${m}${l}${j}${g}${p}`},tt=d=>{const[o,u]=r.useState(null),[m,l]=r.useState(!1),[j,g]=r.useState(""),[p,S]=r.useState([]),[v,F]=r.useState("record");r.useState();const[i,h]=r.useState(),[B,x]=r.useState(),{data:f,setData:c,post:C}=M({story:"",music:"",post_code:"",address:"",latitude:d.position.lat,longitude:d.position.lng}),N=A().props.settings.map_api_key,D=e=>{h(e);const s=URL.createObjectURL(e);x(s),c("music",e)},$=({isRecording:e,stopCallback:s,startCallback:a})=>t.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#E5671D] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:e?s:a,type:"button",children:e?t.jsx(I,{fontSize:"large"}):t.jsx(K,{fontSize:"large"})}),T=async()=>{try{o&&o.destroy();const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),s=new W(e.clone(),{type:"audio",recorderType:q.StereoAudioRecorder,mimeType:"audio/wav"});s.startRecording(),u(s),l(!0)}catch(e){e instanceof Error&&g("録音の開始に失敗しました: "+e.message)}},U=()=>{o&&o.stopRecording(()=>{const e=P(),s=o.getBlob(),a=new File([s],"audio_"+e+".wav",{type:"audio/wav"}),y=URL.createObjectURL(s);l(!1);const k=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),L={audioURL:y,blob:s,id:k,recDate:e};S([...p,L]),x(y),h(a),c("music",a)})};r.useEffect(()=>{const e=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${f.latitude},${f.longitude}&key=${N}`;return fetch(e).then(s=>s.json()).then(s=>{if(s.results.length>0){const a=s.results[0].formatted_address;c("address",a)}else console.log("No results found")}).catch(s=>{console.log("Error:",s)}),()=>{o&&o.destroy()}},[]);const E=e=>{e.preventDefault(),h(),x(),C(route("posts.store"))},_=e=>{F(e.target.value)};return t.jsx(t.Fragment,{children:t.jsxs(G,{component:"form",encType:"multipart/form-data",onSubmit:E,children:[t.jsxs("div",{className:"py-3 w-full flex items-center justify-center bg-pink-200",children:[t.jsx(z,{className:"px-6 absolute left-0",href:"/posts",children:"戻る"}),t.jsx("div",{className:"",children:"音楽を設置する"}),t.jsx("div",{className:"mr-3 absolute right-0",children:t.jsx(V,{type:"submit",variant:"outlined",color:"inherit",children:"登録"})})]}),t.jsxs("div",{className:"px-3",children:[t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"設置場所"}),t.jsx(b,{variant:"standard",multiline:!0,className:"text w-full",defaultValue:f.address,onChange:e=>c("address",e.target.value)}),t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ストーリー"}),t.jsx(b,{variant:"standard",multiline:!0,className:"text w-full",onChange:e=>c("story",e.target.value)}),t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"投稿方法"}),t.jsxs(H,{defaultValue:"record",row:!0,onChange:_,children:[t.jsx(R,{value:"record",control:t.jsx(w,{}),label:"録音"}),t.jsx(R,{value:"file",control:t.jsx(w,{}),label:"ファイルアップロード"})]}),v==="record"&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 flex flex-col justify-center items-center z-50 w-375 py-16",children:t.jsx($,{isRecording:m,stopCallback:U,startCallback:T})})}),v==="file"&&t.jsxs(t.Fragment,{children:[t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ファイル選択"}),t.jsx(O,{value:i,onChange:D,variant:"standard"}),t.jsx("br",{}),t.jsx(n,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),i&&!(i.type==="audio/mpeg"||i.type==="audio/wav"||i.type==="audio/webm")&&t.jsx(n,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"})]}),t.jsx("div",{className:"mt-3",children:t.jsx("audio",{controls:!0,src:B})})]})]})})};export{tt as default};
