import{r as s,W as k,q as A,j as t}from"./app-BhpkOes0.js";import{T as n,a as R,s as z}from"./mui-file-input.es-B5WfxVCB.js";import{R as V,a as H}from"./RecordRTC-1WeCGwBD.js";import{R as O,F as b,a as w,d as W,b as q}from"./Stop-Bmg8DDYo.js";import{M as G}from"./ModalHeader-2-fZrI0I.js";import{B as I}from"./Box-CC2oQ5BL.js";import"./ButtonBase-B7zefz_i.js";import"./createSvgIcon-Bi6DWb3r.js";import"./Button-fUr7Pc7U.js";const K=l=>{const r=new Date,u=r.getFullYear(),m=r.getMonth()+1,d=r.getDate(),j=r.getHours(),g=r.getMinutes(),p=r.getSeconds();return`${u}${m}${d}${j}${g}${p}`},rt=l=>{const[r,u]=s.useState(null),[m,d]=s.useState(!1),[j,g]=s.useState(""),[p,S]=s.useState([]),[v,F]=s.useState("record"),[i,h]=s.useState(),[C,x]=s.useState(),{data:f,setData:c,post:B}=k({story:"",music:"",post_code:"",address:"",latitude:l.position.lat,longitude:l.position.lng}),D=A().props.settings.map_api_key,$=e=>{h(e);const o=URL.createObjectURL(e);x(o),c("music",e)},T=({isRecording:e,stopCallback:o,startCallback:a})=>t.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#E5671D] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:e?o:a,type:"button",children:e?t.jsx(W,{fontSize:"large"}):t.jsx(q,{fontSize:"large"})}),U=async()=>{try{r&&r.destroy();const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),o=new V(e.clone(),{type:"audio",recorderType:H.StereoAudioRecorder,mimeType:"audio/wav"});o.startRecording(),u(o),d(!0)}catch(e){e instanceof Error&&g("録音の開始に失敗しました: "+e.message)}},E=()=>{r&&r.stopRecording(()=>{const e=K(),o=r.getBlob(),a=new File([o],"audio_"+e+".wav",{type:"audio/wav"}),y=URL.createObjectURL(o);d(!1);const _=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),L={audioURL:y,blob:o,id:_,recDate:e};S([...p,L]),x(y),h(a),c("music",a)})};s.useEffect(()=>{const e=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${f.latitude},${f.longitude}&key=${D}`;return fetch(e).then(o=>o.json()).then(o=>{if(o.results.length>0){const a=o.results[0].formatted_address;c("address",a)}else console.log("No results found")}).catch(o=>{console.log("Error:",o)}),()=>{r&&r.destroy()}},[]);const M=e=>{e.preventDefault(),h(),x(),B(route("posts.store"))},N=e=>{F(e.target.value)};return t.jsx(t.Fragment,{children:t.jsxs(I,{component:"form",encType:"multipart/form-data",onSubmit:M,children:[t.jsx(G,{header:"音楽を設置する"}),t.jsxs("div",{className:"px-3 pt-8",children:[t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"設置場所"}),t.jsx(R,{variant:"standard",multiline:!0,className:"text w-full",defaultValue:f.address,onChange:e=>c("address",e.target.value)}),t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ストーリー"}),t.jsx(R,{variant:"standard",multiline:!0,className:"text w-full",onChange:e=>c("story",e.target.value)}),t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"投稿方法"}),t.jsxs(O,{defaultValue:"record",row:!0,onChange:N,children:[t.jsx(b,{value:"record",control:t.jsx(w,{}),label:"録音"}),t.jsx(b,{value:"file",control:t.jsx(w,{}),label:"ファイルアップロード"})]}),v==="record"&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 flex flex-col justify-center items-center z-50 w-375 py-16",children:t.jsx(T,{isRecording:m,stopCallback:E,startCallback:U})})}),v==="file"&&t.jsxs(t.Fragment,{children:[t.jsx(n,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ファイル選択"}),t.jsx(z,{value:i,onChange:$,variant:"standard"}),t.jsx("br",{}),t.jsx(n,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),i&&!(i.type==="audio/mpeg"||i.type==="audio/wav"||i.type==="audio/webm")&&t.jsx(n,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"})]}),t.jsx("div",{className:"mt-3",children:t.jsx("audio",{controls:!0,src:C})})]})]})})};export{rt as default};
