import{j as e,d as Z,c as j,r as o,W as ee}from"./app-BKVF0Qni.js";import{r as f,i as g}from"./ButtonBase-9Lj1nNSh.js";import{R as te,a as re}from"./RecordRTC-Bf_ImQ5J.js";import{R as se,F as $,a as N,d as oe,b as ae}from"./Stop-BZSqSnhv.js";import{I as D,M as ne,B as ce,T as l,a as ie,s as le}from"./mui-file-input.es-CPdeybpx.js";const de=r=>e.jsxs("div",{className:"py-3 w-full flex items-center justify-center bg-pink-200",children:[e.jsx(Z,{className:"px-6 absolute left-0",href:"/posts",children:"戻る"}),e.jsx("div",{className:"",children:r.header})]});var p={},ue=g;Object.defineProperty(p,"__esModule",{value:!0});var L=p.default=void 0,me=ue(f()),B=j();L=p.default=(0,me.default)([(0,B.jsx)("path",{d:"M14 9c0-2.04 1.24-3.79 3-4.57V4c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h9c1.1 0 2-.9 2-2v-2.42c-1.76-.78-3-2.53-3-4.58m-4 5H6v-2h4zm3-3H6V9h7zm0-3H6V6h7z"},"0"),(0,B.jsx)("path",{d:"M20 6.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V3h2V1h-4z"},"1")],"LyricsRounded");var y={},he=g;Object.defineProperty(y,"__esModule",{value:!0});var k=y.default=void 0,ve=he(f()),xe=j();k=y.default=(0,ve.default)((0,xe.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");var R={},je=g;Object.defineProperty(R,"__esModule",{value:!0});var T=R.default=void 0,fe=je(f()),ge=j();T=R.default=(0,fe.default)((0,ge.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");const pe=()=>{const r=new Date,m=r.getFullYear(),a=r.getMonth()+1,n=r.getDate(),h=r.getHours(),v=r.getMinutes(),d=r.getSeconds();return`${m}${a}${n}${h}${v}${d}`},Fe=r=>{const m="../storage/audio/",a=r.post,[n,h]=o.useState(null),[v,d]=o.useState(!1),[ye,U]=o.useState(""),[z,P]=o.useState([]),[b,E]=o.useState("record");o.useState();const[i,_]=o.useState(),[C,w]=o.useState(),[I,S]=o.useState(!1),{data:Re,setData:x,post:F}=ee({text:"",music:"",post_id:"",user_id:""});console.log(r);const c=o.useRef(null);function O(){S(!0)}function V(){S(!1)}const q=t=>{_(t);const s=URL.createObjectURL(t);w(s),x("music",t),console.log("setFile")},H=({isRecording:t,stopCallback:s,startCallback:u})=>e.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#E5671D] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:t?s:u,type:"button",children:t?e.jsx(oe,{fontSize:"large"}):e.jsx(ae,{fontSize:"large"})}),A=async()=>{try{n&&n.destroy();const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),s=new te(t.clone(),{type:"audio",recorderType:re.StereoAudioRecorder,mimeType:"audio/wav"});s.startRecording(),Y(),h(s),d(!0)}catch(t){t instanceof Error&&U("録音の開始に失敗しました: "+t.message)}},W=()=>{K(),n&&n.stopRecording(()=>{console.log(n);const t=pe(),s=n.getBlob(),u=new File([s],"audio_"+t+".wav",{type:"audio/wav"}),M=URL.createObjectURL(s);d(!1);const Q=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),X={audioURL:M,blob:s,id:Q,recDate:t};P([...z,X]),w(M),_(u),x("music",u)})},G=t=>{r.isLike?(console.log("いいね削除"),F(route("like.destroy",r.post),{preserveScroll:!0})):(console.log("いいね"),F(route("like.store",r.post)))},J=t=>{E(t.target.value)},Y=()=>{c.current.volume=.3,c.current.play(),console.log(c)},K=()=>{c.current.pause(),c.current.currentTime=0};return e.jsxs("div",{children:[e.jsx(de,{header:"再生"}),e.jsxs("div",{className:"mx-3 border-dotted border-b-2 border-gray-400",children:[e.jsx("div",{children:a.user.name}),e.jsx("div",{children:a.created_at}),e.jsx("div",{children:a.address}),e.jsx("div",{children:a.story}),e.jsx("audio",{ref:c,controls:!0,src:m+a.user_id+"/"+a.music}),e.jsxs("div",{className:"flex justify-around my-3 mx-3",children:[e.jsx(D,{onClick:G,children:r.isLike?e.jsx(T,{style:{color:"#eb3495"}}):e.jsx(k,{})}),e.jsx(D,{onClick:O,children:e.jsx(L,{})})]})]}),e.jsx("div",{children:e.jsx(ne,{className:"",open:I,onClose:V,children:e.jsxs("div",{className:"bg-white absolute bottom-0 w-full h-2/3 px-3 overflow-y-scroll",children:[e.jsxs("div",{className:"py-3 w-full flex items-center justify-center",children:[e.jsx("div",{className:"",children:"コメントを書く"}),e.jsx("div",{className:"mr-3 absolute right-0",children:e.jsx(ce,{type:"submit",variant:"outlined",color:"inherit",children:"投稿"})})]}),e.jsx(l,{variant:"body1",component:"h6",mt:3,gutterBottom:!0,children:"コメント"}),e.jsx(ie,{variant:"standard",multiline:!0,className:"text w-full",onChange:t=>x("text",t.target.value)}),e.jsx(l,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"投稿方法"}),e.jsxs(se,{defaultValue:"record",row:!0,onChange:J,children:[e.jsx($,{value:"record",control:e.jsx(N,{}),label:"録音"}),e.jsx($,{value:"file",control:e.jsx(N,{}),label:"ファイルアップロード"})]}),b==="record"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:C})}),e.jsx("div",{className:"flex flex-col justify-center items-center z-50 py-8",children:e.jsx(H,{isRecording:v,stopCallback:W,startCallback:A})})]}),b==="file"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"body1",component:"h6",mt:3,gutterBottom:!0,children:"ファイル選択"}),e.jsx(le,{value:i,onChange:q,variant:"standard"}),e.jsx("br",{}),e.jsx(l,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),i&&!(i.type==="audio/mpeg"||i.type==="audio/wav"||i.type==="audio/webm")&&e.jsx(l,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"}),e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:C})})]})]})})})]})};export{Fe as default};
