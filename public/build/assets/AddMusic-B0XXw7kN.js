import{r as a,j as e,W as k,d as P}from"./app-BKVF0Qni.js";import{B as A,T as d,a as w,s as I}from"./mui-file-input.es-CPdeybpx.js";import{R as z,a as V}from"./RecordRTC-Bf_ImQ5J.js";import{R as W,F as B,a as S,d as G,b as H}from"./Stop-BZSqSnhv.js";import{s as O,a as K,u as Y,e as q,_ as J,b as Q,c as X,g as Z,d as ee,T as te,C as se}from"./ButtonBase-9Lj1nNSh.js";const oe=["className","component"];function ae(u={}){const{themeId:s,defaultTheme:m,defaultClassName:i="MuiBox-root",generateClassName:c}=u,f=O("div",{shouldForwardProp:r=>r!=="theme"&&r!=="sx"&&r!=="as"})(K);return a.forwardRef(function(b,v){const g=Y(m),n=q(b),{className:x,component:y="div"}=n,h=J(n,oe);return e.jsx(f,Q({as:y,ref:v,className:X(x,c?c(i):i),theme:s&&g[s]||g},h))})}const re=Z("MuiBox",["root"]),ne=re,ce=ee(),le=ae({themeId:te,defaultTheme:ce,defaultClassName:ne.root,generateClassName:se.generate}),ie=le,de=u=>{const s=new Date,m=s.getFullYear(),i=s.getMonth()+1,c=s.getDate(),f=s.getHours(),j=s.getMinutes(),r=s.getSeconds();return`${m}${i}${c}${f}${j}${r}`},pe=u=>{const[s,m]=a.useState(null),[i,c]=a.useState(!1),[f,j]=a.useState(""),[r,b]=a.useState([]),[v,g]=a.useState("record");a.useState();const[n,x]=a.useState(),[y,h]=a.useState(),{data:R,setData:p,post:N}=k({story:"",music:"",post_code:"",address:"",latitude:u.position.lat,longitude:u.position.lng}),F=usePage().props.settings.map_api_key,T=t=>{x(t);const o=URL.createObjectURL(t);h(o),p("music",t),console.log("setFile")},_=({isRecording:t,stopCallback:o,startCallback:l})=>e.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#E5671D] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:t?o:l,type:"button",children:t?e.jsx(G,{fontSize:"large"}):e.jsx(H,{fontSize:"large"})}),$=async()=>{try{s&&s.destroy();const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),o=new z(t.clone(),{type:"audio",recorderType:V.StereoAudioRecorder,mimeType:"audio/wav"});o.startRecording(),m(o),c(!0)}catch(t){t instanceof Error&&j("録音の開始に失敗しました: "+t.message)}},D=()=>{s&&s.stopRecording(()=>{console.log(s);const t=de(),o=s.getBlob(),l=new File([o],"audio_"+t+".wav",{type:"audio/wav"}),C=URL.createObjectURL(o);c(!1);const M=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),L={audioURL:C,blob:o,id:M,recDate:t};b([...r,L]),h(C),x(l),p("music",l)})};a.useEffect(()=>{const t=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${R.latitude},${R.longitude}&key=${F}`;return fetch(t).then(o=>o.json()).then(o=>{if(o.results.length>0){const l=o.results[0].formatted_address;p("address",l),console.log(l)}else console.log("No results found")}).catch(o=>{console.log("Error:",o)}),()=>{s&&s.destroy()}},[]);const E=t=>{t.preventDefault(),x(),h(),N(route("posts.store"))},U=t=>{g(t.target.value)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-3 w-full flex items-center justify-center bg-pink-200",children:[e.jsx(P,{className:"px-6 absolute left-0",href:"/posts",children:"戻る"}),e.jsx("div",{className:"",children:"音楽を設置する"}),e.jsx("div",{className:"mr-3 absolute right-0",children:e.jsx(A,{type:"submit",variant:"outlined",color:"inherit",children:"登録"})})]}),e.jsxs(ie,{component:"form",onSubmit:E,children:[e.jsx(d,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"設置場所"}),e.jsx(w,{variant:"standard",multiline:!0,className:"text w-full",defaultValue:R.address,onChange:t=>p("address",t.target.value)}),e.jsx(d,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ストーリー"}),e.jsx(w,{variant:"standard",multiline:!0,className:"text w-full",onChange:t=>p("story",t.target.value)}),e.jsx(d,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"投稿方法"}),e.jsxs(W,{defaultValue:"record",row:!0,onChange:U,children:[e.jsx(B,{value:"record",control:e.jsx(S,{}),label:"録音"}),e.jsx(B,{value:"file",control:e.jsx(S,{}),label:"ファイルアップロード"})]}),v==="record"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 flex flex-col justify-center items-center z-50 w-375 py-16",children:e.jsx(_,{isRecording:i,stopCallback:D,startCallback:$})})}),v==="file"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"ファイル選択"}),e.jsx(I,{value:n,onChange:T,variant:"standard"}),e.jsx("br",{}),e.jsx(d,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),n&&!(n.type==="audio/mpeg"||n.type==="audio/wav"||n.type==="audio/webm")&&e.jsx(d,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"})]}),e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:y})})]})]})};export{pe as default};
