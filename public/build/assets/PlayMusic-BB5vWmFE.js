import{r,j as e,W as le}from"./app-au_dz3zB.js";import{I as H,M as we}from"./ModalHeader-Dj9yJzxA.js";import{a as L,g as ke,s as Fe,B as Oe,r as Le,b as S,e as O,u as Be,_ as Pe,f as Te,h as De,c as X,d as ze,i as B}from"./ButtonBase-Fhvr62SK.js";import{r as P}from"./createSvgIcon-Cu8M6P0d.js";import{R as Ve,a as Ee}from"./RecordRTC-BcFWCFtT.js";import{L as Z,M as Ue,c as He,R as Ae,F as ee,a as te,s as qe,T as se,d as Ge,b as We}from"./Stop-Bayl4Boy.js";import{B as ce}from"./Box-DcZVPe1H.js";import{I as U}from"./InputLabel-DAxdTiOm.js";import{B as M}from"./Button-C46Gqqjc.js";import{T as Ye}from"./TextareaAutosize-DTDiuh7D.js";const Je=L("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),ae=Je,Ke=L("MuiListItemIcon",["root","alignItemsFlexStart"]),oe=Ke,Qe=L("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),re=Qe;function Xe(t){return ke("MuiMenuItem",t)}const Ze=L("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),N=Ze,et=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],tt=(t,o)=>{const{ownerState:i}=t;return[o.root,i.dense&&o.dense,i.divider&&o.divider,!i.disableGutters&&o.gutters]},st=t=>{const{disabled:o,dense:i,divider:l,disableGutters:d,selected:u,classes:m}=t,f=ze({root:["root",i&&"dense",o&&"disabled",!d&&"gutters",l&&"divider",u&&"selected"]},Xe,m);return S({},m,f)},at=Fe(Oe,{shouldForwardProp:t=>Le(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:tt})(({theme:t,ownerState:o})=>S({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!o.disableGutters&&{paddingLeft:16,paddingRight:16},o.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${N.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:O(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${N.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:O(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${N.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:O(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:O(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${N.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${N.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${ae.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${ae.inset}`]:{marginLeft:52},[`& .${re.root}`]:{marginTop:0,marginBottom:0},[`& .${re.inset}`]:{paddingLeft:36},[`& .${oe.root}`]:{minWidth:36}},!o.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},o.dense&&S({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${oe.root} svg`]:{fontSize:"1.25rem"}}))),ot=r.forwardRef(function(o,i){const l=Be({props:o,name:"MuiMenuItem"}),{autoFocus:d=!1,component:u="li",dense:m=!1,divider:x=!1,disableGutters:f=!1,focusVisibleClassName:T,role:_="menuitem",tabIndex:I,className:y}=l,w=Pe(l,et),n=r.useContext(Z),v=r.useMemo(()=>({dense:m||n.dense||!1,disableGutters:f}),[n.dense,m,f]),p=r.useRef(null);Te(()=>{d&&p.current&&p.current.focus()},[d]);const j=S({},l,{dense:v.dense,divider:x,disableGutters:f}),g=st(l),C=De(p,i);let k;return l.disabled||(k=I!==void 0?I:-1),e.jsx(Z.Provider,{value:v,children:e.jsx(at,S({ref:C,role:_,tabIndex:k,component:u,focusVisibleClassName:X(g.focusVisible,T),className:X(g.root,y)},w,{ownerState:j,classes:g}))})}),rt=ot;var A={},it=B;Object.defineProperty(A,"__esModule",{value:!0});var de=A.default=void 0,nt=it(P()),ie=e;de=A.default=(0,nt.default)([(0,ie.jsx)("path",{d:"M14 9c0-2.04 1.24-3.79 3-4.57V4c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h9c1.1 0 2-.9 2-2v-2.42c-1.76-.78-3-2.53-3-4.58m-4 5H6v-2h4zm3-3H6V9h7zm0-3H6V6h7z"},"0"),(0,ie.jsx)("path",{d:"M20 6.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V3h2V1h-4z"},"1")],"LyricsRounded");var q={},lt=B;Object.defineProperty(q,"__esModule",{value:!0});var ue=q.default=void 0,ct=lt(P()),dt=e;ue=q.default=(0,ct.default)((0,dt.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");var G={},ut=B;Object.defineProperty(G,"__esModule",{value:!0});var me=G.default=void 0,mt=ut(P()),pt=e;me=G.default=(0,mt.default)((0,pt.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");var W={},ft=B;Object.defineProperty(W,"__esModule",{value:!0});var pe=W.default=void 0,xt=ft(P()),vt=e;pe=W.default=(0,xt.default)((0,vt.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");const ne=t=>{const[o,i]=r.useState(!1),l=r.useRef(null),{post:d}=le({}),u=()=>{i(!o)},m=()=>{i(!1)},x=()=>{t.target==="post"?d(route("post.destroy",t.id),{onBefore:()=>confirm("本当に削除しますか?")}):t.target==="comment"&&d(route("comment.destroy",t.id),{onBefore:()=>confirm("本当に削除しますか?")})};return e.jsxs(ce,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[e.jsx(Ue,{id:"menu-app-bar",anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:o,onClose:m,children:e.jsx(rt,{onClick:x,children:"削除"})}),e.jsx(H,{type:"button",ref:l,onClick:u,children:e.jsx(pe,{})})]})},gt=()=>{const t=new Date,o=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),d=t.getHours(),u=t.getMinutes(),m=t.getSeconds();return`${o}${i}${l}${d}${u}${m}`},_t=t=>{const o="../storage/audio/",[i,l]=r.useState(null),[d,u]=r.useState(!1),[m,x]=r.useState(""),[f,T]=r.useState([]),[_,I]=r.useState("record"),[y,w]=r.useState([]),[n,v]=r.useState(t.post),[p,j]=r.useState(),[g,C]=r.useState(),[k,D]=r.useState(!1),[Y,R]=r.useState({}),{data:fe,setData:$,post:z}=le({text:"",music:"",music_flg:0,post_id:t.post.id,user_id:t.auth.user.id});r.useEffect(()=>{w(t.post.comments)},[t.post]),r.useEffect(()=>{Q()},[y]);const h=r.useRef(null),b=r.useRef({});function xe(){D(!0)}function ve(){D(!1)}const ge=s=>{j(s);const a=URL.createObjectURL(s);C(a),$("music",s)},he=({isRecording:s,stopCallback:a,startCallback:c})=>e.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#f7576b] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:s?a:c,type:"button",children:s?e.jsx(Ge,{style:{color:"white"},fontSize:"large"}):e.jsx(We,{style:{color:"white"},fontSize:"large"})}),be=async()=>{try{i&&i.destroy();const s=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),a=new Ve(s.clone(),{type:"audio",recorderType:Ee.StereoAudioRecorder,mimeType:"audio/wav"});a.startRecording(),V(),l(a),u(!0)}catch(s){s instanceof Error&&x("録音の開始に失敗しました: "+s.message)}},ye=()=>{E(),i&&i.stopRecording(()=>{const s=gt(),a=i.getBlob(),c=new File([a],"audio_"+s+".wav",{type:"audio/wav"}),F=URL.createObjectURL(a);u(!1);const _e=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),Ie={audioURL:F,blob:a,id:_e,recDate:s};T([...f,Ie]),C(F),j(c),$("music",c)})},je=s=>{t.isLike?z(route("like.destroy",n),{preserveScroll:!0,onSuccess:()=>{v(a=>({...a,liked_count:a.liked_count-1}))}}):z(route("like.store",n),{onSuccess:()=>{v(a=>({...a,liked_count:a.liked_count+1}))}})},Ce=s=>{I(s.target.value),s.target.value=="record"?$("music_flg",0):$("music_flg",1)},V=()=>{h.current.volume=.3,h.current.play()},E=()=>{h.current.pause(),h.current.currentTime=0},J=s=>{b.current[s].volume=.3,b.current[s].play()},K=s=>{b.current[s].pause(),b.current[s].currentTime=0},Q=()=>{const s={};y.forEach(a=>{s[a.id]="stopped"}),R(s)},Re=(s,a)=>{Q();let c=0;s==0&&(c=100),E(),K(a),J(a),setTimeout(()=>{V()},c),R(F=>({...F,[a]:"playing"}))},$e=s=>{V(),J(s),R(a=>({...a,[s]:"playing"}))},Me=s=>{E(),K(s),R(a=>({...a,[s]:"stopped"}))},Ne=s=>{h.current.pause(),b.current[s].pause(),R(a=>({...a,[s]:"paused"}))},Se=s=>{s.preventDefault(),j(),C(),D(!1),z(route("comment.store"),{onSuccess:a=>{w(a.props.post.comments),v(c=>({...c,comments_count:c.comments_count+1}))}})};return e.jsxs("div",{className:"text-gray-800",children:[e.jsx(we,{header:"再生"}),e.jsxs("div",{className:"mx-4 pt-12 border-dotted border-b-2 border-gray-400",children:[e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsx("img",{className:"mr-2 w-12 h-12",style:{borderRadius:"50%"},src:`../storage/image/${n.user.account.icon}`,alt:"アイコン"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:n.user.name}),e.jsx("div",{className:"text-gray-500",children:n.created_at})]}),t.auth.user.id===n.user.id&&e.jsx(ne,{target:"post",id:n.id})]}),e.jsx("div",{className:"mt-2",children:n.address}),e.jsx("div",{className:"mt-2",children:n.story}),e.jsx("audio",{id:"main",ref:h,controls:!0,src:o+n.user_id+"/"+n.music,className:"mt-2 mx-auto"}),e.jsxs("div",{className:"flex justify-around mt-2 ml-2 mr-8",children:[e.jsxs(H,{type:"button",onClick:je,children:[t.isLike?e.jsx(me,{style:{color:"#eb3495"}}):e.jsx(ue,{}),e.jsx("div",{className:"ml-1 text-lg",children:n.liked_count})]}),e.jsxs(H,{type:"button",onClick:xe,children:[e.jsx(de,{}),e.jsx("div",{className:"ml-1 text-lg",children:n.comments_count})]})]})]}),y.map((s,a)=>e.jsxs("div",{className:"mx-4 py-3 border-dotted border-b-2 border-gray-400",children:[e.jsxs("div",{className:"mt-2 flex",children:[e.jsx("img",{className:"mr-2 w-12 h-12",style:{borderRadius:"50%"},src:`../storage/image/${s.user.account.icon}`,alt:"アイコン"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:s.user.name}),e.jsx("div",{className:"text-gray-500",children:s.created_at})]}),t.auth.user.id===s.user.id&&e.jsx("div",{className:"ml-auto",children:e.jsx(ne,{target:"comment",id:s.id})})]}),e.jsx("div",{className:"mt-2",children:s.text})]})]}),e.jsx("audio",{className:"my-3 mx-auto",ref:c=>b.current[s.id]=c,controls:!0,src:o+s.user_id+"/"+s.music}),e.jsx("div",{className:"text-center w-full",children:Y[s.id]==="stopped"?e.jsx(M,{variant:"outlined",onClick:()=>Re(s.music_flg,s.id),style:{color:"#f7576b",borderColor:"#f7576b"},children:"Session"}):e.jsxs("div",{className:"mx-auto",children:[Y[s.id]==="paused"?e.jsx(M,{variant:"outlined",onClick:()=>$e(s.id),style:{color:"#f7576b",borderColor:"#f7576b"},children:"Play"}):e.jsx(M,{variant:"outlined",onClick:()=>Ne(s.id),style:{color:"#f7576b",borderColor:"#f7576b"},children:"Pause"}),e.jsx(M,{variant:"outlined",onClick:()=>Me(s.id),style:{color:"#f7576b",borderColor:"#f7576b",marginLeft:"12px"},children:"Stop"})]})})]},a)),e.jsx("div",{children:e.jsx(He,{className:"",open:k,onClose:ve,children:e.jsx("div",{className:"bg-white absolute bottom-0 w-full h-2/3 px-3 overflow-y-scroll",children:e.jsxs(ce,{component:"form",onSubmit:Se,encType:"multipart/form-data",className:"px-3",children:[e.jsxs("div",{className:"py-3 w-full flex items-center justify-center",children:[e.jsx("div",{className:"",children:"コメントを書く"}),e.jsx("div",{className:"mr-3 absolute right-0",children:e.jsx(M,{variant:"outlined",color:"inherit",type:"submit",style:{color:"#f7576b",borderColor:"#f7576b"},children:"投稿"})})]}),e.jsx(U,{htmlFor:"comment",value:"コメント",className:"mt-8 text-lg"}),e.jsx(Ye,{id:"comment",minRows:3,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",value:fe.story,onChange:s=>$("text",s.target.value),required:!0,isFocused:!0,autoComplete:"comment"}),e.jsx(U,{htmlFor:"post",value:"投稿方法",className:"mt-8 text-lg"}),e.jsxs(Ae,{defaultValue:"record",row:!0,onChange:Ce,children:[e.jsx(ee,{value:"record",control:e.jsx(te,{}),label:"録音"}),e.jsx(ee,{value:"file",control:e.jsx(te,{}),label:"ファイルアップロード"})]}),_==="record"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:g})}),e.jsx("div",{className:"flex flex-col justify-center items-center z-50 py-8",children:e.jsx(he,{type:"button",isRecording:d,stopCallback:ye,startCallback:be})})]}),_==="file"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{htmlFor:"file",value:"ファイル選択",className:"mt-8 text-lg"}),e.jsx(qe,{value:p,onChange:ge,variant:"standard",className:"w-full"}),e.jsx("br",{}),e.jsx(se,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),p&&!(p.type==="audio/mpeg"||p.type==="audio/wav"||p.type==="audio/webm")&&e.jsx(se,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"}),e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:g})})]})]})})})})]})};export{_t as default};
