import{r as o,j as e,W as ne}from"./app-BhpkOes0.js";import{I as H,M as Ie}from"./ModalHeader-2-fZrI0I.js";import{a as F,g as Ne,s as we,B as ke,r as Be,b as _,e as O,u as Oe,_ as Fe,f as Le,h as De,c as X,d as Pe,i as L}from"./ButtonBase-B7zefz_i.js";import{r as D}from"./createSvgIcon-Bi6DWb3r.js";import{R as Te,a as Ve}from"./RecordRTC-1WeCGwBD.js";import{R as ze,F as Z,a as ee,d as Ee,b as Ue}from"./Stop-Bmg8DDYo.js";import{L as te,M as He,b as Ae,T as $,a as qe,s as Ge}from"./mui-file-input.es-B5WfxVCB.js";import{B as le}from"./Box-CC2oQ5BL.js";import{B as M}from"./Button-fUr7Pc7U.js";const We=F("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),se=We,Ye=F("MuiListItemIcon",["root","alignItemsFlexStart"]),ae=Ye,Je=F("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),re=Je;function Ke(t){return Ne("MuiMenuItem",t)}const Qe=F("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),S=Qe,Xe=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Ze=(t,r)=>{const{ownerState:i}=t;return[r.root,i.dense&&r.dense,i.divider&&r.divider,!i.disableGutters&&r.gutters]},et=t=>{const{disabled:r,dense:i,divider:l,disableGutters:c,selected:d,classes:u}=t,v=Pe({root:["root",i&&"dense",r&&"disabled",!c&&"gutters",l&&"divider",d&&"selected"]},Ke,u);return _({},u,v)},tt=we(ke,{shouldForwardProp:t=>Be(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Ze})(({theme:t,ownerState:r})=>_({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!r.disableGutters&&{paddingLeft:16,paddingRight:16},r.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${S.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:O(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${S.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:O(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${S.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:O(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:O(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${S.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${S.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${se.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${se.inset}`]:{marginLeft:52},[`& .${re.root}`]:{marginTop:0,marginBottom:0},[`& .${re.inset}`]:{paddingLeft:36},[`& .${ae.root}`]:{minWidth:36}},!r.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},r.dense&&_({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${ae.root} svg`]:{fontSize:"1.25rem"}}))),st=o.forwardRef(function(r,i){const l=Oe({props:r,name:"MuiMenuItem"}),{autoFocus:c=!1,component:d="li",dense:u=!1,divider:f=!1,disableGutters:v=!1,focusVisibleClassName:P,role:I="menuitem",tabIndex:N,className:b}=l,w=Fe(l,Xe),n=o.useContext(te),T=o.useMemo(()=>({dense:u||n.dense||!1,disableGutters:v}),[n.dense,u,v]),p=o.useRef(null);Le(()=>{c&&p.current&&p.current.focus()},[c]);const j=_({},l,{dense:T.dense,divider:f,disableGutters:v}),x=et(l),y=De(p,i);let k;return l.disabled||(k=N!==void 0?N:-1),e.jsx(te.Provider,{value:T,children:e.jsx(tt,_({ref:y,role:I,tabIndex:k,component:d,focusVisibleClassName:X(x.focusVisible,P),className:X(x.root,b)},w,{ownerState:j,classes:x}))})}),at=st;var A={},rt=L;Object.defineProperty(A,"__esModule",{value:!0});var ce=A.default=void 0,ot=rt(D()),oe=e;ce=A.default=(0,ot.default)([(0,oe.jsx)("path",{d:"M14 9c0-2.04 1.24-3.79 3-4.57V4c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h9c1.1 0 2-.9 2-2v-2.42c-1.76-.78-3-2.53-3-4.58m-4 5H6v-2h4zm3-3H6V9h7zm0-3H6V6h7z"},"0"),(0,oe.jsx)("path",{d:"M20 6.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V3h2V1h-4z"},"1")],"LyricsRounded");var q={},it=L;Object.defineProperty(q,"__esModule",{value:!0});var de=q.default=void 0,nt=it(D()),lt=e;de=q.default=(0,nt.default)((0,lt.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");var G={},ct=L;Object.defineProperty(G,"__esModule",{value:!0});var ue=G.default=void 0,dt=ct(D()),ut=e;ue=G.default=(0,dt.default)((0,ut.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");var W={},pt=L;Object.defineProperty(W,"__esModule",{value:!0});var pe=W.default=void 0,mt=pt(D()),vt=e;pe=W.default=(0,mt.default)((0,vt.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");const ie=t=>{const[r,i]=o.useState(!1),l=o.useRef(null),{post:c}=ne({}),d=()=>{i(!r)},u=()=>{i(!1)},f=()=>{t.target==="post"?c(route("post.destroy",t.id),{onBefore:()=>confirm("本当に削除しますか?")}):t.target==="comment"&&c(route("comment.destroy",t.id),{onBefore:()=>confirm("本当に削除しますか?")})};return e.jsxs(le,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[e.jsx(He,{id:"menu-app-bar",anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:r,onClose:u,children:e.jsx(at,{onClick:f,children:"削除"})}),e.jsx(H,{type:"button",ref:l,onClick:d,children:e.jsx(pe,{})})]})},ft=()=>{const t=new Date,r=t.getFullYear(),i=t.getMonth()+1,l=t.getDate(),c=t.getHours(),d=t.getMinutes(),u=t.getSeconds();return`${r}${i}${l}${c}${d}${u}`},St=t=>{const r="../storage/audio/",[i,l]=o.useState(null),[c,d]=o.useState(!1),[u,f]=o.useState(""),[v,P]=o.useState([]),[I,N]=o.useState("record"),[b,w]=o.useState([]),[n,T]=o.useState(t.post),[p,j]=o.useState(),[x,y]=o.useState(),[k,V]=o.useState(!1),[Y,C]=o.useState({}),{data:xt,setData:R,post:z}=ne({text:"",music:"",music_flg:0,post_id:t.post.id,user_id:t.auth.user.id});o.useEffect(()=>{w(t.post.comments)},[t.post]),o.useEffect(()=>{Q()},[b]);const g=o.useRef(null),h=o.useRef({});function me(){V(!0)}function ve(){V(!1)}const fe=s=>{j(s);const a=URL.createObjectURL(s);y(a),R("music",s)},xe=({isRecording:s,stopCallback:a,startCallback:m})=>e.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#E5671D] hover:bg-[#FFB2A9] duration-300 transition drop-shadow-md active:translate-y-3",onClick:s?a:m,type:"button",children:s?e.jsx(Ee,{fontSize:"large"}):e.jsx(Ue,{fontSize:"large"})}),ge=async()=>{try{i&&i.destroy();const s=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),a=new Te(s.clone(),{type:"audio",recorderType:Ve.StereoAudioRecorder,mimeType:"audio/wav"});a.startRecording(),E(),l(a),d(!0)}catch(s){s instanceof Error&&f("録音の開始に失敗しました: "+s.message)}},he=()=>{U(),i&&i.stopRecording(()=>{const s=ft(),a=i.getBlob(),m=new File([a],"audio_"+s+".wav",{type:"audio/wav"}),B=URL.createObjectURL(a);d(!1);const Se=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),_e={audioURL:B,blob:a,id:Se,recDate:s};P([...v,_e]),y(B),j(m),R("music",m)})},be=s=>{t.isLike?z(route("like.destroy",n),{preserveScroll:!0}):z(route("like.store",n))},je=s=>{N(s.target.value),s.target.value=="record"?R("music_flg",0):R("music_flg",1)},E=()=>{g.current.volume=.3,g.current.play()},U=()=>{g.current.pause(),g.current.currentTime=0},J=s=>{h.current[s].volume=.3,h.current[s].play()},K=s=>{h.current[s].pause(),h.current[s].currentTime=0},Q=()=>{const s={};b.forEach(a=>{s[a.id]="stopped"}),C(s)},ye=(s,a)=>{Q();let m=0;s==0&&(m=100),U(),K(a),J(a),setTimeout(()=>{E()},m),C(B=>({...B,[a]:"playing"}))},Ce=s=>{E(),J(s),C(a=>({...a,[s]:"playing"}))},Re=s=>{U(),K(s),C(a=>({...a,[s]:"stopped"}))},$e=s=>{g.current.pause(),h.current[s].pause(),C(a=>({...a,[s]:"paused"}))},Me=s=>{s.preventDefault(),j(),y(),V(!1),z(route("comment.store"),{onSuccess:a=>{w(a.props.post.comments)}})};return e.jsxs("div",{children:[e.jsx(Ie,{header:"再生"}),e.jsxs("div",{className:"mx-4 pt-12 border-dotted border-b-2 border-gray-400",children:[e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("img",{className:"mr-2 w-12 h-12",style:{borderRadius:"50%"},src:`../storage/image/${n.user.account.icon}`,alt:"アイコン"}),e.jsxs("div",{children:[e.jsx("div",{children:n.user.name}),e.jsx("div",{children:n.created_at})]}),t.auth.user.id===n.user.id&&e.jsx(ie,{target:"post",id:n.id})]}),e.jsx("div",{className:"mt-2",children:n.address}),e.jsx("div",{className:"mt-2",children:n.story}),e.jsx("audio",{id:"main",ref:g,controls:!0,src:r+n.user_id+"/"+n.music,className:"mt-2"}),e.jsxs("div",{className:"flex justify-around mt-2 ml-2 mr-8",children:[e.jsxs(H,{type:"button",onClick:be,children:[t.isLike?e.jsx(ue,{style:{color:"#eb3495"}}):e.jsx(de,{}),e.jsx("div",{className:"ml-1 text-lg",children:n.liked_count})]}),e.jsxs(H,{type:"button",onClick:me,children:[e.jsx(ce,{}),e.jsx("div",{className:"ml-1 text-lg",children:n.comments_count})]})]})]}),b.map((s,a)=>e.jsxs("div",{className:"mx-4 py-3 border-dotted border-b-2 border-gray-400",children:[e.jsxs("div",{className:"mt-2 flex items-center",children:[e.jsx("img",{className:"mr-2 w-12 h-12",style:{borderRadius:"50%"},src:`../storage/image/${s.user.account.icon}`,alt:"アイコン"}),e.jsxs("div",{children:[e.jsx("div",{children:s.user.name}),e.jsx("div",{children:s.created_at})]}),t.auth.user.id===s.user.id&&e.jsx(ie,{target:"comment",id:s.id})]}),e.jsx("div",{className:"mt-2",children:s.text}),e.jsx("audio",{className:"my-2",ref:m=>h.current[s.id]=m,controls:!0,src:r+s.user_id+"/"+s.music}),Y[s.id]==="stopped"?e.jsx(M,{variant:"outlined",onClick:()=>ye(s.music_flg,s.id),style:{color:"#eb3495",borderColor:"#eb3495"},children:"Session"}):e.jsxs("div",{className:"flex",children:[Y[s.id]==="paused"?e.jsx("div",{className:"mx-3",children:e.jsx(M,{variant:"outlined",onClick:()=>Ce(s.id),style:{color:"#eb3495",borderColor:"#eb3495"},children:"Play"})}):e.jsx("div",{className:"mx-3",children:e.jsx(M,{variant:"outlined",onClick:()=>$e(s.id),style:{color:"#eb3495",borderColor:"#eb3495"},children:"Pause"})}),e.jsx(M,{variant:"outlined",onClick:()=>Re(s.id),style:{color:"#eb3495",borderColor:"#eb3495"},children:"Stop"})]})]},a)),e.jsx("div",{children:e.jsx(Ae,{className:"",open:k,onClose:ve,children:e.jsx("div",{className:"bg-white absolute bottom-0 w-full h-2/3 px-3 overflow-y-scroll",children:e.jsxs(le,{component:"form",onSubmit:Me,encType:"multipart/form-data",className:"px-3",children:[e.jsxs("div",{className:"py-3 w-full flex items-center justify-center",children:[e.jsx("div",{className:"",children:"コメントを書く"}),e.jsx("div",{className:"mr-3 absolute right-0",children:e.jsx(M,{variant:"outlined",color:"inherit",type:"submit",children:"投稿"})})]}),e.jsx($,{variant:"body1",component:"h6",mt:3,gutterBottom:!0,children:"コメント"}),e.jsx(qe,{variant:"standard",multiline:!0,className:"text w-full",onChange:s=>R("text",s.target.value)}),e.jsx($,{variant:"body1",component:"h6",mt:5,gutterBottom:!0,children:"投稿方法"}),e.jsxs(ze,{defaultValue:"record",row:!0,onChange:je,children:[e.jsx(Z,{value:"record",control:e.jsx(ee,{}),label:"録音"}),e.jsx(Z,{value:"file",control:e.jsx(ee,{}),label:"ファイルアップロード"})]}),I==="record"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:x})}),e.jsx("div",{className:"flex flex-col justify-center items-center z-50 py-8",children:e.jsx(xe,{type:"button",isRecording:c,stopCallback:he,startCallback:ge})})]}),I==="file"&&e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"body1",component:"h6",mt:3,gutterBottom:!0,children:"ファイル選択"}),e.jsx(Ge,{value:p,onChange:fe,variant:"standard"}),e.jsx("br",{}),e.jsx($,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),p&&!(p.type==="audio/mpeg"||p.type==="audio/wav"||p.type==="audio/webm")&&e.jsx($,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"}),e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:x})})]})]})})})})]})};export{St as default};
