import{r,W as q,q as z,j as e}from"./app-au_dz3zB.js";import{R as A,F as v,a as R,s as I,T as w,d as H,b as O}from"./Stop-Bayl4Boy.js";import{R as V,a as W}from"./RecordRTC-BcFWCFtT.js";import{M as G}from"./ModalHeader-Dj9yJzxA.js";import{I as l}from"./InputLabel-DAxdTiOm.js";import"./TextInput-BZEnmTLV.js";import{B as K}from"./Box-DcZVPe1H.js";import{T as F}from"./TextareaAutosize-DTDiuh7D.js";import"./ButtonBase-Fhvr62SK.js";import"./createSvgIcon-Cu8M6P0d.js";import"./Button-C46Gqqjc.js";const P=u=>{const s=new Date,m=s.getFullYear(),g=s.getMonth()+1,d=s.getDate(),j=s.getHours(),p=s.getMinutes(),f=s.getSeconds();return`${m}${g}${d}${j}${p}${f}`},ne=u=>{const[s,m]=r.useState(null),[g,d]=r.useState(!1),[j,p]=r.useState(""),[f,C]=r.useState([]),[b,S]=r.useState("record"),[n,h]=r.useState(),[N,x]=r.useState(),{data:c,setData:i,post:T}=q({story:"",music:"",post_code:"",address:"",latitude:u.position.lat,longitude:u.position.lng}),$=z().props.settings.map_api_key,D=t=>{h(t);const o=URL.createObjectURL(t);x(o),i("music",t)},U=({isRecording:t,stopCallback:o,startCallback:a})=>e.jsx("button",{className:"rounded-full w-20 h-20 shadow-lg bg-[#e26575] hover:bg-[#f0b5bd] duration-300 transition drop-shadow-md active:translate-y-3",onClick:t?o:a,type:"button",children:t?e.jsx(H,{style:{color:"white"},fontSize:"large"}):e.jsx(O,{style:{color:"white"},fontSize:"large"})}),k=async()=>{try{s&&s.destroy();const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),o=new V(t.clone(),{type:"audio",recorderType:W.StereoAudioRecorder,mimeType:"audio/wav"});o.startRecording(),m(o),d(!0)}catch(t){t instanceof Error&&p("録音の開始に失敗しました: "+t.message)}},M=()=>{s&&s.stopRecording(()=>{const t=P(),o=s.getBlob(),a=new File([o],"audio_"+t+".wav",{type:"audio/wav"}),y=URL.createObjectURL(o);d(!1);const _=Math.random().toString(32).substring(2)+new Date().getTime().toString(32),B={audioURL:y,blob:o,id:_,recDate:t};C([...f,B]),x(y),h(a),i("music",a)})};r.useEffect(()=>{const t=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${c.latitude},${c.longitude}&key=${$}`;return fetch(t).then(o=>o.json()).then(o=>{if(o.results.length>0){const a=o.results[0].formatted_address;i("address",a)}else console.log("No results found")}).catch(o=>{console.log("Error:",o)}),()=>{s&&s.destroy()}},[]);const E=t=>{t.preventDefault(),h(),x(),T(route("posts.store"))},L=t=>{S(t.target.value)};return e.jsx(e.Fragment,{children:e.jsxs(K,{component:"form",encType:"multipart/form-data",onSubmit:E,children:[e.jsx(G,{header:"音楽を設置する"}),e.jsxs("div",{className:"px-3 pt-12",children:[e.jsx(l,{htmlFor:"address",value:"設置場所",className:"mt-8 text-lg"}),e.jsx(F,{id:"address",minRows:3,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",value:c.address,onChange:t=>i("address",t.target.value),required:!0,isFocused:!0,autoComplete:"address"}),e.jsx(l,{htmlFor:"story",value:"ストーリー",className:"mt-8 text-lg"}),e.jsx(F,{id:"story",minRows:3,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",value:c.story,onChange:t=>i("story",t.target.value),required:!0,isFocused:!0,autoComplete:"story"}),e.jsx(l,{htmlFor:"post",value:"投稿方法",className:"mt-8 text-lg"}),e.jsxs(A,{defaultValue:"record",row:!0,onChange:L,children:[e.jsx(v,{value:"record",control:e.jsx(R,{}),label:"録音"}),e.jsx(v,{value:"file",control:e.jsx(R,{}),label:"ファイルアップロード"})]}),b==="record"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed bottom-0 left-1/2 -translate-x-1/2 flex flex-col justify-center items-center z-50 w-375 py-16",children:e.jsx(U,{isRecording:g,stopCallback:M,startCallback:k})})}),b==="file"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{htmlFor:"file",value:"ファイル選択",className:"mt-8 text-lg"}),e.jsx(I,{value:n,onChange:D,variant:"standard",required:!0,className:"block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 shadow-sm"}),e.jsx("br",{}),e.jsx(w,{variant:"caption",component:"div",gutterBottom:!0,children:"MP3/WAV ファイルのみ。"}),n&&!(n.type==="audio/mpeg"||n.type==="audio/wav"||n.type==="audio/webm")&&e.jsx(w,{variant:"caption",component:"div",color:"error.main",gutterBottom:!0,children:"このファイルタイプはサポートしていません。"})]}),e.jsx("div",{className:"mt-3",children:e.jsx("audio",{controls:!0,src:N})})]})]})})};export{ne as default};
